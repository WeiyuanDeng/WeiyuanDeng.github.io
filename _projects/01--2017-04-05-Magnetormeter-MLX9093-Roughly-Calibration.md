---
layout: project
title: Magnetic Tracking System - Magnetometer MLX90393 Study
date: April 05, 2017
image: /public/images/sensor_new.jpg
---

## Overview
The objective of the project is to design a magnetic tracking system that can work under granular material for a burrowing robot. The calibration of the magnetometer is the first step of the whole project. During the process, a magnet was moved at a constant distance at a time and magnetic strength from the sensor was recorded.

### Magnet
A tiny common magnet with the North pole marked with black dot.

### Sensor
The magnetometer used in the project is a [MLX90393](https://www.sparkfun.com/products/14294) from [Sparkfun](https://www.sparkfun.com/) (There will be more magnetometer added later).

![Sensor](/public/images/sensor.png)

It is a tri-axial magnetic sensor capable of sensing very small fields (like the Earth’s magnetic field) while behaving as one would want and expect during saturation in larger fields (like a near by magnet).It has a resolution of 0.161µT, and a max full scale resolution of 44,000µT. Both of I2C and SPI could be used to connect it, and user selectable I2C address supports up to four sensors on the I2C bus at a time.

Here is the [datasheet for MLX90393](https://cdn.sparkfun.com/assets/learn_tutorials/5/7/7/MLX90393-Datasheet-Melexis.PDF).

### Microcontroller
To connect the sensor with the computer, an [Arduino Uno R3](https://www.arduino.cc/en/Main/ArduinoBoardUno) is used.

![Uno](/public/images/uno.png)

Arduino Uno is a microcontroller board based on the ATmega328P ([datasheet](http://www.atmel.com/images/Atmel-8271-8-bit-AVR-Microcontroller-ATmega48A-48PA-88A-88PA-168A-168PA-328-328P_datasheet_Complete.pdf)). It has 14 digital input/output pins (of which 6 can be used as PWM outputs), 6 analog inputs, a 16 MHz quartz crystal, a USB connection, a power jack, an ICSP header and a reset button.

To get started with Arduino Uno, [here](https://www.arduino.cc/en/Guide/HomePage) is a guide from Arduino official website.

### Process
All Qwiic cables have the following color scheme and arrangement:
Black = GND
Red = 3.3V
Blue = SDA
Yellow = SCL

![Pinout](/public/images/pinout.png)

Ted Yapo has written a good Arduino Library for the MLX90393, which could be found [here](https://github.com/tedyapo/arduino-MLX90393).

The ruler is taped along the direction of X-axis of the magnetometer. Magnet can be placed in three different direction on the ruler, as the figure shows below.

![Direction](/public/images/direction.png)

Before the test, the magnetometer recorded data for an hour with the magnet was putting far enough. Then take the average of the recording data to get the earth magnetic strength.

In the test, the magnet was moved from 500 mm from the breakout board to 30 or 20 mm (to prevent damaging the sensor, with the north pole pointed to X-direction, the nearest distance is 30 mm, others are 20 mm). From 500 mm to 100 mm, record the magnetic strengh of X, Y and Z direction every 25 mm. From 100 mm to 20 (30) mm, record data every 5 mm. Plot the data and find function that can fit it.

![magnetometer](/public/images/magnetometer.png)

All were fixed on the desk with tape except the magnet (there are magnets inside the laptop, so it is fixed till the test ended).

### Results
The farthest distance that the MLX90393 can sense the magnetic field of the magnet is around 550 mm from the breakout board (The data read from the sensor will not have any obvious change at a distance of 600 mm).

The magnetic strength without the magnet around are:
magX = 12.50
magY = -4.60
magZ =-60.80
with a temperature of 28.50 celsius degree.

![ear](/public/images/ear.png)

In fact, the magnetic strenght was keeping changing, so the test was finished as soon as possible.

Three plots were generated by [Mathematica](http://www.wolfram.com/mathematica/online/?src=google&420). All of them are in a reasonable pattern. In the fitting part, I tried using nonlinear model with exponential function to fit the data, but came across overflow computation error but haven't solved it yet.

Below are the plots of magnetic strength in different direction vs. distance from magnetometer breakout board (earth magnetic strength has been removed).

![x-direc](/public/images/xdirec.png)

![y-direc](/public/images/ydirec.png)

![z-direc](/public/images/zdirec.png)
